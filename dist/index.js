// Generated by CoffeeScript 1.12.3
(function() {
  var clients, count, fs, http, pry, server, ws, ws_serv;

  http = require('http');

  fs = require('fs');

  pry = require('pryjs');

  server = http.createServer(function(req, res) {
    var file;
    return file = fs.readFile('src/client/ui.html', function(err, data) {
      console.log(data);
      res.writeHead(200, {
        'Content-Type': 'text/html'
      });
      res.write('<title>Hello World Page</title>');
      res.write(data);
      return res.end;
    });
  });

  server.listen(1234, function() {
    return console.log((new Date) + " Server is listening on port 1234");
  });

  ws = require('websocket').server;

  ws_serv = new ws({
    httpServer: server
  });

  count = 0;

  clients = {};

  ws_serv.on('request', function(r) {
    var conn, id;
    conn = r.accept('echo-protocol', r.origin);
    id = count++;
    clients[id] = conn;
    console.log((new Date) + " Connection accepted [" + id + "]");
    conn.on('message', (function(_this) {
      return function(message) {
        var msg;
        console.log(message);
        msg = message.utf8Data;
        return clients[0].sendUTF(msg);
      };
    })(this));
    return conn.on('close', (function(_this) {
      return function(reason, desc) {
        delete clients[id];
        return console.log('#{new Date} Peer #{conn.remoteAddress} disconnected');
      };
    })(this));
  });

}).call(this);
